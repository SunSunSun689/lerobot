# 主臂和从臂关节映射分析报告

## 1. 底座关节 (joint_0) 分析

### 主臂 (Feetech Leader)
- **范围**: -100 到 100 (无单位)
- **映射到弧度**: -π 到 π (-3.14 到 3.14 rad)
- **映射到角度**: -180° 到 180°
- **总范围**: 360°

### 从臂 (ARX-X5)
- **机械限位**: -2.44 到 2.97 rad
- **角度范围**: -140° 到 170°
- **总范围**: 310°

### ⚠️ 问题识别

**范围不匹配**:
- 主臂范围 (360°) > 从臂范围 (310°)
- 主臂可以移动到从臂无法到达的位置

**具体场景**:
```
主臂位置: -100 → 从臂目标: -3.14 rad (-180°)
从臂限位: -2.44 rad (-140°)
结果: 超出限位 40°！
```

## 2. 当前映射方式

### safe_record_simple.py
```python
# 相对位置映射
relative_positions[0] * scale  # joint_0: 正常方向
-relative_positions[1] * scale # joint_1: 反向
```

**问题**: 
- ✅ 使用相对位置（零位对齐）
- ✅ joint_1 已反向
- ❌ **没有软限位保护**

### teleoperate_safe_v2.py
```python
# 有软限位保护
joint_limits = [
    (-2.44, 2.97),   # joint_0: -140° to 170°
    (-0.09, 3.49),   # joint_1: -5° to 200°
    ...
]
```

**优势**:
- ✅ 有软限位保护
- ✅ 防止超出机械范围

## 3. 建议修复

### 方案1: 添加软限位到 safe_record_simple.py
在映射函数中添加限位检查，防止从臂超出机械范围。

### 方案2: 调整映射比例
缩小映射范围，确保主臂全范围运动时从臂不超限：
```python
# 当前: -100~100 → -π~π
# 建议: -100~100 → -2.4~2.9 (从臂安全范围)
scale = 2.65 / 100.0  # (2.9 + 2.4) / 2 / 100
```

### 方案3: 使用 teleoperate_safe_v2.py 的映射
直接使用已有的安全映射逻辑。

## 4. 运动方向检查

### joint_0 (底座)
- **主臂向左** → **从臂向左** ✅ (方向一致)
- **主臂向右** → **从臂向右** ✅ (方向一致)

### joint_1 (肩部)
- **主臂向上** → **从臂向下** ✅ (已反向)
- **主臂向下** → **从臂向上** ✅ (已反向)

## 5. 推荐操作

1. **立即**: 在 safe_record_simple.py 中添加软限位保护
2. **测试**: 验证主臂极限位置时从臂是否安全
3. **调整**: 如果仍有问题，调整映射比例

